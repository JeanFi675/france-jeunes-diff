---
import BaseLayout from '../components/layout/BaseLayout.astro';

import HeroSection from '../components/blocks/HeroSection.astro';
import PublicWelcomeSection from '../components/blocks/PublicWelcomeSection.astro';
import ProgramSection from '../components/blocks/ProgramSection.astro';
import CovoiturageSection from '../components/blocks/CovoiturageSection.astro';
import PracticalInfoSection from '../components/blocks/PracticalInfoSection.astro';
import StatsSection from '../components/blocks/StatsSection.astro';
import ArenaChampionsSection from '../components/blocks/ArenaChampionsSection.astro';
import PartnersSection from '../components/blocks/PartnersSection.astro';
import ContactSection from '../components/blocks/ContactSection.astro';
import FooterSection from '../components/blocks/FooterSection.astro';

const metadata = {
  title: 'Championnats de France Jeunes de Difficulté 2026',
  description:
    "Championnats de France Jeunes de Difficulté d'escalade - 16-17 mai 2026 • Saint-Pierre-en-Faucigny • ENTRÉE GRATUITE • Spectacle familial",
};

const annonceurUrl = `${import.meta.env.BASE_URL}dossier_annonceur/dossier_annonceurs_encarts_publicitaires.html`;
---

<BaseLayout title={metadata.title} description={metadata.description}>
  <HeroSection />
  <PublicWelcomeSection />
  <ProgramSection background="black" />
  <CovoiturageSection />
  <PracticalInfoSection />
  <StatsSection />
  <ArenaChampionsSection />
  <ContactSection id="contact" />
  <PartnersSection />
  <FooterSection />

  <!-- Modal Annonceurs -->
  <div id="annonceurs-modal" class="brutal-modal">
    <div class="brutal-modal-content brutal-iframe-container">
      <iframe
        id="annonceurs-iframe"
        class="brutal-iframe"
        src={annonceurUrl}
        title="Dossier Annonceurs"></iframe>

      <!-- Bouton fermeture -->
      <button id="close-annonceurs-modal" class="brutal-modal-close"> ✕ </button>

      <!-- Lien partager -->
      <a
        href={annonceurUrl}
        class="brutal-modal-share-link"
        target="_blank"
        rel="noopener noreferrer"
        title="Partager le dossier annonceurs"
      >
        PARTAGER →
      </a>
    </div>
  </div>

  <style>
    /* Modal Base */
    .brutal-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      align-items: center;
      justify-content: center;
    }

    /* Modal Content */
    .brutal-modal-content {
      position: relative;
      max-width: 90%;
      max-height: 90%;
    }

    /* Iframe Container */
    .brutal-iframe-container {
      width: 95%;
      height: 95%;
      max-width: 1200px;
      display: flex;
      position: relative;
    }

    /* Iframe */
    .brutal-iframe {
      width: 100%;
      height: 100%;
      border: 4px solid var(--brutal-white);
      box-shadow: 0 0 50px rgba(127, 229, 176, 0.3);
    }

    /* Close Button */
    .brutal-modal-close {
      position: absolute;
      top: -50px;
      right: 0;
      background: var(--brutal-ice);
      color: var(--brutal-black);
      font-size: 2rem;
      font-weight: 900;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .brutal-modal-close:hover {
      background: var(--brutal-white);
      transform: scale(1.1);
    }

    /* Share Link - Bottom Right of Modal */
    .brutal-modal-share-link {
      position: absolute;
      bottom: 1.5rem;
      right: 1.5rem;

      /* Neobrutalist styling */
      background: var(--brutal-ice);
      color: var(--brutal-black);
      padding: 0.75rem 1.5rem;
      border: 3px solid var(--brutal-black);
      box-shadow: 6px 6px 0 var(--brutal-black);

      /* Typography */
      font-weight: 900;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-decoration: none;
      font-family: 'Space Grotesk', sans-serif;

      /* Animation */
      transform: rotate(-1deg);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      z-index: 10;
    }

    .brutal-modal-share-link:hover {
      transform: translate(-3px, -3px) rotate(0deg);
      box-shadow: 9px 9px 0 var(--brutal-black);
    }

    .brutal-modal-share-link:active {
      transform: translate(1px, 1px) rotate(-1deg);
      box-shadow: 3px 3px 0 var(--brutal-black);
    }

    .brutal-modal-share-link:focus-visible {
      outline: 3px solid var(--brutal-white);
      outline-offset: 4px;
      transform: translate(-2px, -2px) rotate(0deg);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .brutal-modal-close {
        font-size: 1.5rem;
        padding: 0.25rem 0.5rem;
        top: -40px;
      }

      .brutal-modal-share-link {
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
        bottom: 1rem;
        right: 1rem;
        box-shadow: 4px 4px 0 var(--brutal-black);
      }

      .brutal-modal-share-link:hover {
        transform: translate(-2px, -2px) rotate(0deg);
        box-shadow: 6px 6px 0 var(--brutal-black);
      }
    }
  </style>

  <script>
    import { BrutalModal } from '../scripts/modal-utils';

    document.addEventListener('DOMContentLoaded', function () {
      // Initialisation du modal Annonceurs via la classe utilitaire
      try {
        const annonceursModal = new BrutalModal('annonceurs-modal');

        // Exposer la fonction d'ouverture globalement (pour compatibilité)
        window.openAnnonceurModal = function () {
          annonceursModal.open();
        };

        // Gestion spécifique Iframe (liens externes)
        const iframe = document.getElementById('annonceurs-iframe') as HTMLIFrameElement | null;
        if (iframe) {
          iframe.addEventListener('load', function () {
            try {
              const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
              if (iframeDoc) {
                const links = iframeDoc.querySelectorAll('a');
                links.forEach((link: HTMLAnchorElement) => {
                  link.addEventListener('click', function (e: Event) {
                    e.preventDefault();
                    const href = link.getAttribute('href');
                    if (href) {
                      window.open(href, '_blank');
                    }
                  });
                });
              }
            } catch {
              // Cannot access iframe links due to CORS or same-origin policy
            }
          });
        }
      } catch (e) {
        console.error('Erreur initialisation modal annouceurs', e);
      }
    });
  </script>
</BaseLayout>
